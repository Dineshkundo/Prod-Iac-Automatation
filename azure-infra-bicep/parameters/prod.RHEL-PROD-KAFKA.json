{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "serviceName": { "value": "RHEL-PROD-KAFKA" },
    "tagSuffix": { "value": "prod" },
    "location": { "value": "eastus" },

    "keyVaultName": {
      "value": "<your-keyvault-name>"
    },

    "secretNames": {
      "value": {
        "rhel-admin-username": "rhel-admin-username",
        "rhel-admin-password": "rhel-admin-password"
      }
    },

    "vmConfig": {
      "value": {
        "name": "RHEL-PROD-KAFKA",
        "zones": [],
        "tags": { "Env": "prod" },
        "vmSize": "Standard_B4ms",
        "additionalCapabilities": {},
        "imageReference": {
          "publisher": "RedHat",
          "offer": "RHEL",
          "sku": "7lvm-gen2",
          "version": "latest"
        },
        "osDisk": {
          "osType": "Linux",
          "name": "RHEL-PROD-KAFKA_OsDisk",
          "caching": "ReadWrite",
          "storageAccountType": "Premium_LRS",
          "id": "/subscriptions/<subid>/resourceGroups/<rg>/providers/Microsoft.Compute/disks/RHEL-PROD-KAFKA_OsDisk",
          "deleteOption": "Detach",
          "diskSizeGB": 64
        },
        "dataDisks": [],
        "osProfile": {
          "computerName": "RHEL-PROD-KAFKA",
          "adminUsername": "@Microsoft.KeyVault(SecretUri=https://<your-keyvault-name>.vault.azure.net/secrets/rhel-admin-username/)",
          "linuxConfiguration": {
            "disablePasswordAuthentication": false,
            "provisionVMAgent": true
          }
        },
        "nicId": "/subscriptions/<subid>/resourceGroups/<rg>/providers/Microsoft.Network/networkInterfaces/rhel-prod-kafka-nic",
        "extension": {
          "name": "enablevmAccess",
          "publisher": "Microsoft.OSTCExtensions",
          "type": "VMAccessForLinux",
          "typeHandlerVersion": "1.5",
          "settings": {},
          "protectedSettings": {
            "username": "@Microsoft.KeyVault(SecretUri=https://<your-keyvault-name>.vault.azure.net/secrets/rhel-admin-username/)",
            "password": "@Microsoft.KeyVault(SecretUri=https://<your-keyvault-name>.vault.azure.net/secrets/rhel-admin-password/)"
          }
        }
      }
    }
  }
}
